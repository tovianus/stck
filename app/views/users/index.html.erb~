<!--- 
TODO
1. filter only for admin
--->
<% provide(:title, "Daftar pengguna aplikasi STCK") %>
<div class="row-fluid"  >
  <div id="pgtitle" class="page-header span12"  >
    <h1>
      <%= yield(:title) %> 
    </h1>
  <div id="pgnav" class="row-fluid pull-left span12 style="border:2px solid">
    <div class="span8">
      <%= link_to 'Tambah pemohon', new_user_path,:class => "btn btn-large btn-primary"  if current_user.is?"admin"%>
    </div>
    <div id="pgsearch" class="span4 pull-right">
      <%= render :partial => 'users/filters' %>
    </div>
  </div>
  <div class="row-fluid span12">
  <%= will_paginate @users %>
    <table class="table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Perusahaan (kode perusahaan)</th>
          <th>Alamat</th>
          <th>Role</th>
          <th>Jml. permohonan</th>
          <th colspan="3">&nbsp</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
        <tr>
          <td><%= user.email %> </td>
          <td><%= user.perusahaan.nama_badan %> (<%= user.perusahaan.kdperusahaan%>) </td>
          <td><%= user.perusahaan.alamat_badan %></td>
          <td><% user.roles.each do |role| %>
              <ul>
                <li><%= role %></li>
              </ul>
              <% end %>	
          </td>
          <td>
              <% if user.stck_requests.count==0 %>
                <span class="label-success"><%= user.stck_requests.count %></span>
              <% else %>
                <span class="label-success"> <%= user.stck_requests.count %> </span>
              <% end %>
          </td>
<!--- Menu --->
          <td>
            <%= link_to 'Tampilkan', edit_user_path(user),:class => "btn btn-small" %>
            <%= link_to 'Rubah', edit_user_path(user),:class => "btn btn-small" %>
            <% unless current_user==user %>
              <% if user.is?"banned" %>
                <%= link_to 'Aktifkan user', user_path(user), :method => 'delete', :confirm => "Aktifkan #{user.email}?",:class => "btn btn-small" %>
              <% else %>
                <%= link_to 'Blok user', user_path(user), :method => 'delete', :confirm => "Blok #{user.email}?",:class => "btn btn-small" %>
              <% end %>
            <% end %>
          </td>
        </tr>
        <% end %>
      <tbody>
    </table>
<%= will_paginate @users %>
  </div>
</div>
